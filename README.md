# 사용자 위치 기반 서울시 공공 와이파이 정보 조회 프로그램
**목적**
- 사용자의 위치를 기준으로 가장 가까운 와이파이 정보를 20개 가져온다.
- 북마크 기능으로 장소에 따른 인근 와이파이를 저장할 수 있다.

<br>

**주요 기능**
- 와이파이 정보 저장
  - 자바 프로젝트에 OpenAPI 연결
  - 라이브러리를 통해 Json타입 데이터 역직렬화
  - 자바 프로젝트에 데이터베이스 연결
- 사용자 위치 정보 저장 및 가까운 와이파이 정보 조회
  - GeoLocation으로 사용자 위치 정보 가져오기
  - 와이파이 위치, 사용자 위치 간 거리 계산
- 북마크 구현
  - 테이블 조인
- 브라우저에 출력
  - Servlet + JSP

<br>

## Development Environment
- Java
  - Platform: JakartaEE 8
  - Template: Web Application
  - Version: JDK 1.8
- IDE: IntelliJ Ultimate
- DataBase: SQLite
- Server: apache-tomcat-8.5.99
- Build: Gradle

<br>

## 시연 영상
| 기능 | 영상 |
|:-:|:-:|
| 와이파이 정보 저장 |![와이파이 데이터 저장](https://github.com/user-attachments/assets/8294e688-3abe-4ebd-80a9-152dff8eeb88)|
| 사용자 위치 저장 및 근처 와이파이 정보 출력 |![사용자 위치 저장 및 와이파이 정보 출력](https://github.com/user-attachments/assets/68f3d8d1-4bb5-433f-ae13-99f02d3da354)|
| 사용자 위치 저장 내역 출력 및 삭제 |![사용자 위치 정보 등록 내역 및 삭제](https://github.com/user-attachments/assets/b6d4ea65-bc0c-4a60-a02a-e5fa04524574)|
| 와이파이 상세 정보 출력 및 북마크 그룹 추가, 수정, 삭제, 출력 |![와이파이 정보 상세보기 및 북마크 그룹](https://github.com/user-attachments/assets/75bd7bf3-653d-49cc-b899-eceee7c56ffa)|
| 북마크 추가, 삭제, 출력 |![북마크](https://github.com/user-attachments/assets/7469b067-754b-47a6-8161-711505ecf968)|

<br>

---

<br>

## 어려웠던 점
### Tomcat 설치
톰캣 9버전 미만은 구버전이기 때문에 아파치 보관소에서 다운을 받아야 한다.<br>
https://archive.apache.org/dist/tomcat/<br>
보관소에서 버전을 선택한 다음 bin 디렉터리에서 운영체제에 맞는 파일을 내려받으면 된다.<br>
나는 apache-tomcat-8.5.99.zip 파일을 내려받아 설치했는데 서버가 구동되긴 하지만 인텔리제이에서는 톰캣을 찾을 수 없어 에러를 띄우는 모순적인 상황이 발생했다.<br>
재설치를 해봐도 여전하길래 아예 새 apache-tomcat-8.5.99-windows-x64.zip 파일을 받아 실행했는데 잘 되는 걸 보면 운영체제의 문제였던 것 같다.<br>

<br>

### java.sql.SQLException
- **Unknown database 'wifi.db'**
  - **잘못된 데이터베이스 URL 작성 시 발생하는 에러**<br>
    DB를 인텔리제이에서 제공하는 Data Sources and Drivers로 생성했기 때문에 JDBC Driver 경로를 지정할 때 DB 생성 시 자동 생성된 기본 경로(jdbc:sqlite:dbname.db)를 작성했었다.<br>
    JUnit 테스트에서는 연결이 성공했기에 넘어갔는데 추후 확인해보니 실제로는 DB에 연결되지 않은 상태였다.<br>
    DB Driver 경로에는 절대 경로를 사용한다기에 수정을 했는데도 연결에 실패하여 sqlite3로 DB를 찾아봤더니 DB 자체가 없었다.(~~분명 파일 탐색기에는 있었다...~~)<br>
    결국 sqlite 쉘에서 DB를 생성한 다음 파일이 존재하는지 확인하고 해당 파일의 절대 경로를 작성했더니 해결되었다.<br>
    알고보니 처음에 작성했던 경로는 프로젝트 내부에 존재하는 로컬 데이터베이스였다. 그래서 JUnit 테스트는 통과했으나 실제 연결에는 실패했던 것 같다.<br>

<br>
    
- **[SQLITE_BUSY] The database file is locked (database is locked)**
  - **SQLite가 동시에 여러 프로세스나 스레드에 접근될 때 발생하는 에러**<br>
    sqlite는 경량화된 데이터베이스인 만큼 한 번에 하나의 쓰기 작업만 가능하다.<br>
    하필 후반에 발생하는 바람에 뒤늦게 트랜잭션 관리를 위해 모든 리포지토리를 리팩토링하는 대공사에 들어갔다.<br>
    리포지토리 객체도 싱글톤으로 수정하고, 자동 커밋을 끈 후 예외 처리로 커밋 및 롤백 관리를 하고, 잠금 레벨도 일반으로 낮춰보고, 대기 시간도 걸어보고...<br>
    구글링을 통해 나온 해결 방법을 하나씩 다 추가 해봤는데도 나의 SQLite는 여전히 바빴다...<br>
    그러다 Stack Overflow에서 SQLite의 경우, 연결 상태를 끊어두다가 DB 접근이 필요할 때만 연결하는 게 좋다는 글을 보고 메서드 호출 시에만 연결이 되도록 수정했더니 해결되었다.<br>
    연결 상태가 유지되다 보니 결국 작업이 중첩되어 에러가 발생한 것 같다.<br>

<br>

### java.lang.NullPointerException
- **값이 null인 객체를 참조하려고 하면 발생하는 에러**<br>
  자주 등장하긴 했지만 초반 와이파이 정보를 저장하는 기능을 구현하면서 발생했을 때가 가장 힘들었다.<br>
  기능 구현 중 역직렬화 한 데이터를 담은 모델 객체 또는 DB Connection 객체 둘 중 하나가 null이라는 에러 메시지가 출력되었다.<br>
  하필 DB가 연결되지 않았다는 걸 몰랐을 때라 모델 객체가 문제라고 확신한 나는 객체에 참조값이 담겨있는 것을 눈으로 확인해놓고도 저장된 데이터 중 null이 있어 발생했다는 믿음을 가지고 데이터를 받아오는 로직에 Optional 처리를 해주었다.<br>
  데이터를 받아올 때 null 처리를 해주는 게 맞긴 하지만 일단 나의 문제는 데이터가 아니었기에 에러가 사라질 기미가 보이지 않았고, 슬슬 불안해져서 설마하는 마음으로 Connection 객체를 확인해 보니 null을 반환하고 있었다!<br>
  위에 작성한 바와 같이 데이터베이스 연동을 정상적으로 성공하여 해결했다.<br>
  데이터 이동 시 자잘한 실수를 했기 때문에 queryString에서 데이터를 받아올 때 값이 비어있는 경우에도 자주 발생했다.<br>

<br>

### java.lang.IllegalArgumentException
- **메서드에 전달된 인자가 적절하지 않거나 예상된 범위나 조건에 맞지 않을 때 발생하는 에러**<br>
  하필 또 나의 콘솔은 한글을 제대로 인코딩하지 못 했기에 쿼리스트링 값이 한글인 경우 콘솔에는 한글이 깨진 상태로 출력되었다.<br>
  작은 희망을 가지고 인텔리제이 설정에서 인코딩 관련을 다 뒤져봤는데 모든 게 UTF-8로 설정되었기에 서버 문제라고 다시 한 번 확신하면서 열심히 인코딩을 시도했다.<br>
  web.xml에 인코딩 필터를 이미 추가한 상태였기에 각 브라우저 별 인코딩 타입을 찾아본 후 타입에 맞게 변환하는 로직도 작성해보고, 톰캣 server.xml에 인코딩을 강제하는 코드도 추가해보고, script에서 인코딩해보는 등 다양하게 실패를 겪었는데 정신차리고 다시 보니 쿼리스트링 값이 문제가 아니라 전송해야 할 데이터 중 하나를 누락하는 바람에 발생한 문제였다...<br>
  누락된 데이터를 다시 추가해 줬더니 바로 해결되었다.<br>

  <br>
  
### javax.el.PropertyNotFoundException
- **Property [X_SWIFI_MAIN_NM]not found on type [com.ian.mission01.Row]**<br>
  - **EL 사용 시, 자바에서 객체와 관련된 필드나 프로퍼티를 찾을 수 없을 때 발생하는 예외**<br>
    JavaBeans 규약을 찾아보면서 필드 명이 모두 대문자인 게 문제가 된 것 같아 모든 필드의 이름을 변경했다.<br>
    하지만 여전히 Getter를 찾을 수 없었기에 롬복 애너테이션을 지운 후 직접 생성해봤는데도 문제는 해결되지 않았다.<br>
    분명 JSTL 라이브러리 존재하고, 필드에 접근만 안 하면 el 사용에도 문제가 없고, Getter는 롬복이 만들어주니 접근 제어자가 public이 아닐 수가 없고, el에 작성한 var, property 이름은 정확하고, 서버 측 데이터가 null인 것도 아니고, Getter 이름의 문제도 아니고...<br>
    아무리 봐도 어디가 문제인지 찾을 수 없어서 지쳐갈 때 역시 단비같은 Stack Overflow에서 문제점을 알려주었다.<br>
    접근하려는 클래스의 접근 제어자가 public이 맞냐는 답변을 발견하고 당연히 public인줄 알았던 나의 클래스를 보았더니 역직렬화 할 때 귀찮다고 처음에만 public 클래스를 생성하고 나머지 클래스는 같은 파일에서 default 클래스로 생성한 것이었다!<br>
    모델 객체들을 public 클래스로 변경하니 해결되었다.<br>
    이후 몇 번 더 발생하긴 했는데 el에 작성한 var, property 오타거나 두 번째 글자가 대문자여서 발생한 에러였기 때문에 오타 수정 및 필드, Getter 이름을 변경하여 해결했다.<br>

### CSS 적용
- style.css의 경로를 올바르게 작성을 했는데도 스타일 적용이 된 jsp가 있는 반면 스타일 적용이 안 된 jsp도 있길래 경로 문제인가 싶어서 link 태그를 수정했다.<br>
  초반엔 부트스트랩 템플릿을 사용했기 때문에 부트스트랩과 CSS의 우선 순위도 변경해보고, 파일 경로도 변경해 보고, body 태그를 새로 작성 해봤는데 여전히 소용이 없었다.<br>
  Visual Studio Code에서는 CSS가 정상적으로 적용이 되었기에 경로나 태그의 문제는 아닌 것 같아 고민하던 중 스타일이 랜덤 적용된 게 수상해서 차이점을 찾아 본 결과 상단에 jsp에 있어선 안 될 `<!DOCTYPE html>`이 선언되어 있었다.<br>
  선언문을 지우니 해결되었다.<br>
  또한 비슷해보이는 속성이 너무 많아서 원하는 디자인을 구현하기 위해서는 어느 속성을 사용해야 하는지 헷갈렸다.<br>

  <br>

  ## 아쉬운 점
마음 만큼은 리액트와 동적 웹페이지로 멋지게 구현하고 싶었는데 아직 실력이 부족해서 못생긴 CSS와 대량의 JSP 파일을 만들었다. <br>
또한 열심히 리팩토링 해봤지만 여전히 효율이 떨어지거나 불필요한 부분이 보이는 것 같다. 특히 과제를 제출한 후 생각해 보니 굳이 action 값을 지정하지 않아도 핸들링이 가능했을 것 같아 아쉬웠다.
